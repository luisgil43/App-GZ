{% extends "dashboard_admin/base.html" %}

{% block title %}Corregir mensaje del bot{% endblock %}

{% block dashboard_content %}
<div class="max-w-3xl mx-auto bg-white shadow mt-6 rounded-2xl px-4 py-5 sm:px-6 sm:py-6">

  <h1 class="text-2xl font-bold text-gray-800 mb-4 flex items-center gap-2">
    âœï¸ Corregir mensaje para entrenamiento
  </h1>

  <div class="mb-4 text-xs text-gray-500">
    ID mensaje: {{ msg.id }} â€¢ Creado: {{ msg.creado_en|date:"Y-m-d H:i" }} â€¢ Chat: {{ msg.chat_id }}
  </div>

  <div class="mb-4 border rounded-xl p-3 bg-gray-50 text-sm">
    <h2 class="text-xs font-semibold text-gray-600 mb-1">Texto original</h2>
    <p class="whitespace-pre-line text-gray-800">
      {{ msg.texto }}
    </p>
  </div>

  <div class="grid grid-cols-1 md:grid-cols-2 gap-3 mb-5 text-sm">
    <div class="border rounded-xl p-3">
      <h3 class="text-xs font-semibold text-gray-600 mb-1">Intent detectado</h3>
      {% if msg.intent_detectado %}
        <p class="font-mono text-xs bg-gray-100 px-2 py-1 rounded inline-block">
          {{ msg.intent_detectado.slug }} ({{ msg.intent_detectado.get_scope_display }})
        </p>
      {% else %}
        <p class="text-gray-400 text-xs">Sin intent detectado</p>
      {% endif %}
      <p class="mt-1 text-[11px] text-gray-400">
        Confianza:
        {% if msg.confianza is not None %}
          {{ msg.confianza|floatformat:3 }}
        {% else %}
          â€”
        {% endif %}
      </p>
      <p class="mt-1 text-[11px] text-gray-400">
        Status interno: {{ msg.get_status_display }}
      </p>
    </div>

    <div class="border rounded-xl p-3">
      <h3 class="text-xs font-semibold text-gray-600 mb-1">Usuario</h3>
      {% if msg.usuario %}
        <p class="text-sm text-gray-800">
          {{ msg.usuario.get_full_name|default:msg.usuario.username }}
        </p>
        <p class="text-[11px] text-gray-400">
          ID interno: {{ msg.usuario.id }}
        </p>
      {% else %}
        <p class="text-gray-400 text-xs">Sin usuario vinculado</p>
      {% endif %}
    </div>
  </div>

  <form method="post" class="space-y-4 text-sm">
    {% csrf_token %}

    <div>
      <label for="intent_corregido" class="block text-xs font-semibold text-gray-600 mb-1">
        Intent corregido (lo que CREES que el usuario realmente quiso decir)
      </label>
      <select name="intent_corregido"
              id="intent_corregido"
              class="w-full border rounded-lg px-2 py-1.5">
        <option value="">â€” Sin correcciÃ³n / dejar sin intent â€”</option>
        {% for intent in intents %}
          <option value="{{ intent.id }}"
                  {% if msg.intent_corregido and msg.intent_corregido.id == intent.id %}selected{% endif %}>
            {{ intent.slug }} ({{ intent.get_scope_display }}) â€” {{ intent.nombre }}
          </option>
        {% endfor %}
      </select>
      <p class="mt-1 text-[11px] text-gray-400">
        Este valor se usarÃ¡ luego para entrenar al bot (modelo futuro).
      </p>
    </div>

    <div class="flex items-center gap-2">
      <input type="checkbox"
             id="marcar_para_entrenamiento"
             name="marcar_para_entrenamiento"
             value="1"
             class="rounded border-gray-300"
             {% if msg.marcar_para_entrenamiento %}checked{% endif %}>
      <label for="marcar_para_entrenamiento" class="text-xs text-gray-700">
        Mantener este mensaje marcado para entrenamiento.
      </label>
    </div>

    <div class="flex flex-wrap gap-2 mt-4">
      <button type="submit"
              class="bg-blue-600 hover:bg-blue-700 text-white px-4 py-2 rounded-full text-sm shadow">
        ğŸ’¾ Guardar cambios
      </button>
      <a href="{% url 'bot_gz:training_dashboard' %}"
         class="px-4 py-2 rounded-full text-sm border border-gray-300 text-gray-700 hover:bg-gray-50">
        â¬… Volver al listado
      </a>
    </div>
  </form>

</div>
{% endblock %}